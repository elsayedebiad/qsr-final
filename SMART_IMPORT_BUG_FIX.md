# ๐ ุฅุตูุงุญ ูุดููุฉ ุงูุฑูุน ุงูุฐูู - Invalid prisma.cV.create() invocation

**ุงูุชุงุฑูุฎ:** 2 ุฃูุชูุจุฑ 2025  
**ุงููุดููุฉ:** ูุดู ุงุณุชูุฑุงุฏ ุงูุณูุฑ ุงูุฐุงุชูุฉ ูู ููู Excel ุจุณุจุจ ุฎุทุฃ Prisma

---

## ๐ด ุงููุดููุฉ

ุนูุฏ ูุญุงููุฉ ุฑูุน ููู Excel ุจุงุณุชุฎุฏุงู "ุงูุฑูุน ุงูุฐูู"ุ ุธูุฑ ุงูุฎุทุฃ ุงูุชุงูู:

```
Invalid `prisma.cV.create()` invocation:

{
  data: {
    fullName: "MEKIDA ESMO ABDO",
    fullNameArabic: "ูููุฏุฉ ุฅุณูู ุนุจุฏู",
    email: "ุบูุฑ ูุณุชุฎุฏู",
    phone: "201122324455",
    ...
  }
}
```

---

## ๐ ุชุญููู ุงููุดููุฉ

ุชู ุชุญุฏูุฏ **3 ุฃุณุจุงุจ ุฑุฆูุณูุฉ** ูููุดููุฉ:

### 1๏ธโฃ **ุงูููู ุงููุงุฑุบุฉ ุงูุฒุงุฆูุฉ** โ
```javascript
// ูุจู ุงูุฅุตูุงุญ
email: "ุบูุฑ ูุณุชุฎุฏู"  // ุชู ุชุฎุฒูููุง ููุต!
```

**ุงููุดููุฉ:** ูุงูุช ุฏุงูุฉ `cleanStringValue()` ุชูุจู ูุตูุต ูุซู:
- `"ุบูุฑ ูุณุชุฎุฏู"`
- `"ุบูุฑ ูุชููุฑ"`
- `"N/A"`
- `"-"`

ูุชุฎุฒููุง ูููู ูุตูุฉ ูุนููุฉ ุจุฏูุงู ูู `null`.

---

### 2๏ธโฃ **ุชูุฑุงุฑ ุงูุฃููุงุฏ ุงููุฑุฌุนูุฉ** ๐
```prisma
// ูู schema.prisma
referenceCode  String?  @unique  // โ๏ธ ููุฏ unique
```

**ุงููุดููุฉ:** ูู ููู ุงููุธุงู ูุชุญูู ูู ุชูุฑุงุฑ `referenceCode` ูุจู ุงูุฅุฏุฎุงู:
- ุฅุฐุง ูุงู ููุงู ุณุฌูุงู ุจููุณ `referenceCode` โ ูุดู ุงูุฅุฏุฎุงู
- ุฅุฐุง ูุงู ููุงู `referenceCode` ููุฌูุฏ ูุณุจูุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช โ ูุดู ุงูุฅุฏุฎุงู

---

### 3๏ธโฃ **Prisma Client ุบูุฑ ูุญุฏุซ** ๐
```typescript
// ุฎุทุฃ TypeScript
cvImageUrl' does not exist in type 'CVCreateInput'
```

**ุงููุดููุฉ:** ุชู ุฅุถุงูุฉ ุญูู `cvImageUrl` ุฅูู schema.prisma ููู ูู ูุชู ุฅุนุงุฏุฉ ุชูููุฏ Prisma Client.

---

## โ ุงูุญููู ุงููุทุจูุฉ

### 1๏ธโฃ **ุชุญุณูู ุฏุงูุฉ `cleanStringValue()`**

**ูุจู ุงูุฅุตูุงุญ:**
```typescript
const cleanStringValue = (value: any): string | undefined => {
  if (!value) return undefined
  return String(value).trim() || undefined
}
```

**ุจุนุฏ ุงูุฅุตูุงุญ:**
```typescript
const cleanStringValue = (value: any): string | undefined => {
  if (!value) return undefined
  const cleaned = String(value).trim()
  
  // ุชุญููู ุงูููู ุงูุงูุชุฑุงุถูุฉ ุงููุงุฑุบุฉ ุฅูู undefined
  const emptyValues = [
    'ุบูุฑ ูุณุชุฎุฏู', 
    'ุบูุฑ ูุชููุฑ', 
    'ูุง ููุฌุฏ',
    'N/A', 
    'n/a', 
    'NA', 
    'na',
    'NULL',
    'null',
    '-',
    '--',
    '---',
    ''
  ]
  
  if (!cleaned || emptyValues.includes(cleaned)) {
    return undefined  // โ ูุชู ุชุญููููุง ุฅูู null ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  }
  
  return cleaned
}
```

**ุงููุชูุฌุฉ:**
```javascript
// ุงูุขู
email: "ุบูุฑ ูุณุชุฎุฏู"  โ  email: null  โ
referenceCode: "-"    โ  referenceCode: null  โ
phone: "N/A"          โ  phone: null  โ
```

---

### 2๏ธโฃ **ุฅุถุงูุฉ ูุญุต ุชูุฑุงุฑ `referenceCode`**

**ูุจู ุงูุฅุตูุงุญ:**
```typescript
const checkForDuplicates = async (cv: ProcessedCV, processedPassports: Set<string>) => {
  // ูุงู ููุญุต ููุท: passportNumber, fullName
  // ูู ููุญุต: referenceCode โ
}
```

**ุจุนุฏ ุงูุฅุตูุงุญ:**
```typescript
const checkForDuplicates = async (cv: ProcessedCV, processedPassports: Set<string>) => {
  try {
    // โ ูุญุต ุงูููุฏ ุงููุฑุฌุนู ุฃููุงู (ูู ููุฏ unique)
    if (cv.referenceCode && cv.referenceCode.trim()) {
      const referenceCode = cv.referenceCode.trim()
      
      const existingByRefCode = await prisma.cV.findFirst({
        where: { referenceCode: referenceCode },
        select: {
          id: true,
          fullName: true,
          referenceCode: true
        }
      })
      
      if (existingByRefCode) {
        console.log(`ุชู ุงูุนุซูุฑ ุนูู ุชูุฑุงุฑ ุจุงูููุฏ ุงููุฑุฌุนู: ${referenceCode}`)
        return { 
          isDuplicate: true, 
          existingId: existingByRefCode.id,
          reason: `ุงูููุฏ ุงููุฑุฌุนู ููุฌูุฏ ูุณุจูุงู ููุดุฎุต: ${existingByRefCode.fullName}` 
        }
      }
    }
    
    // ... ุจููุฉ ุงููุญูุตุงุช (passportNumber, fullName)
  } catch (error) {
    console.error('Error checking duplicates:', error)
    return { isDuplicate: false }
  }
}
```

**ุงููุชูุฌุฉ:**
- โ ุฅุฐุง ูุงู `referenceCode` ููุฌูุฏ ูุณุจูุงู โ ุณูุชู **ุชุญุฏูุซ** ุงูุณุฌู ุงููุฏูู
- โ ุฅุฐุง ูุงู `referenceCode` ููุฑุฑ ูู ููุณ ุงูููู โ ุณูุชู **ุชุฌุงูู** ุงูุณุฌู ุงูุซุงูู
- โ ูู ูุญุฏุซ ุฎุทุฃ `Unique constraint violation`

---

### 3๏ธโฃ **ุฅุนุงุฏุฉ ุชูููุฏ Prisma Client**

```bash
# ุฅููุงู ุฌููุน ุนูููุงุช Node.js
Get-Process node -ErrorAction SilentlyContinue | Stop-Process -Force

# ุฅุนุงุฏุฉ ุชูููุฏ Prisma Client
npx prisma generate

# ุฅุนุงุฏุฉ ุชุดุบูู ุงูุณูุฑูุฑ
npm run dev
```

**ุงููุชูุฌุฉ:**
```typescript
// ุงูุขู TypeScript ูุนุฑู cvImageUrl โ
await prisma.cV.create({
  data: {
    fullName: "Ahmed",
    cvImageUrl: "https://example.com/cv.jpg",  // โ ุตุญูุญ ุงูุขู
    ...
  }
})
```

---

## ๐ ุณูุฑ ุนูู ุงูุงุณุชูุฑุงุฏ ุงูุขู

### ุงููุฑุญูุฉ 1: ูุฑุงุกุฉ Excel
```
๐ qsr-template.xlsx
   โ
   ูุฑุงุกุฉ ุฌููุน ุงูุตููู
   โ
   ุชุญููููุง ุฅูู JSON
```

### ุงููุฑุญูุฉ 2: ุชูุธูู ุงูุจูุงูุงุช
```
๐งน cleanStringValue()
   โโ "ุบูุฑ ูุณุชุฎุฏู" โ null โ
   โโ "N/A" โ null โ
   โโ "-" โ null โ
   โโ "" โ null โ
   โโ "Ahmed" โ "Ahmed" โ
```

### ุงููุฑุญูุฉ 3: ูุญุต ุงูุชูุฑุงุฑุงุช
```
๐ checkForDuplicates()
   โโ 1๏ธโฃ ูุญุต referenceCode
   โ  โโ ููุฌูุฏุ โ ุชุญุฏูุซ โ
   โ  โโ ุบูุฑ ููุฌูุฏุ โ ูุชุงุจุนุฉ โ
   โโ 2๏ธโฃ ูุญุต passportNumber
   โ  โโ ููุฌูุฏุ โ ุชุญุฏูุซ โ
   โ  โโ ููุฑุฑ ูู ุงููููุ โ ุชุฌุงูู โ๏ธ
   โ  โโ ุบูุฑ ููุฌูุฏุ โ ูุชุงุจุนุฉ โ
   โโ 3๏ธโฃ ูุญุต fullName
      โโ ููุฌูุฏุ โ ุชุญุฏูุซ โ
      โโ ุบูุฑ ููุฌูุฏุ โ ุณุฌู ุฌุฏูุฏ ๐
```

### ุงููุฑุญูุฉ 4: ุญูุธ ุงูุจูุงูุงุช
```
๐พ prisma.cV.create() / update()
   โโ ุฌููุน ุงูููู ูุธููุฉ โ
   โโ ูุง ุชูุฌุฏ ุชูุฑุงุฑุงุช โ
   โโ cvImageUrl ููุฌูุฏ ูู ุงูููุน โ
```

---

## ๐ฏ ุงูุญููู ุฐุงุช ูููุฏ Unique

| ุงูุญูู | ุงูููุฏ | ุณููู ุงููุธุงู |
|------|------|-------------|
| `id` | PRIMARY KEY | ุชููุงุฆู (auto-increment) |
| **`referenceCode`** | UNIQUE | โ ููุญุต ุงูุชูุฑุงุฑ ูุจู ุงูุฅุฏุฎุงู |
| **`passportNumber`** | UNIQUE | โ ููุญุต ุงูุชูุฑุงุฑ ูุจู ุงูุฅุฏุฎุงู |

---

## ๐งช ุงุฎุชุจุงุฑ ุงูุญู

### ูุจู ุงูุฅุตูุงุญ โ
```
ููู Excel ุจู:
- email: "ุบูุฑ ูุณุชุฎุฏู"
- referenceCode: "QSR-001" (ููุฌูุฏ ูุณุจูุงู)

ุงููุชูุฌุฉ:
โ Invalid `prisma.cV.create()` invocation
```

### ุจุนุฏ ุงูุฅุตูุงุญ โ
```
ููู Excel ุจู:
- email: "ุบูุฑ ูุณุชุฎุฏู"  โ null
- referenceCode: "QSR-001" (ููุฌูุฏ ูุณุจูุงู)

ุงููุชูุฌุฉ:
โ ุชู ุงูุนุซูุฑ ุนูู ุชูุฑุงุฑ ุจุงูููุฏ ุงููุฑุฌุนู
โ ุณูุชู ุชุญุฏูุซ ุงูุณุฌู ุงูููุฌูุฏ
โ ุงูุงุณุชูุฑุงุฏ ูุฌุญ!
```

---

## ๐ ุงูููู ุงูุงูุชุฑุงุถูุฉ ุงููุฏุนููุฉ ุงูุขู

ุฌููุน ูุฐู ุงูููู ุณูุชู ุชุญููููุง ุฅูู `null`:

### ุนุฑุจู
- `ุบูุฑ ูุณุชุฎุฏู`
- `ุบูุฑ ูุชููุฑ`
- `ูุง ููุฌุฏ`

### ุฅูุฌููุฒู
- `N/A`
- `n/a`
- `NA`
- `na`
- `NULL`
- `null`

### ุฑููุฒ
- `-`
- `--`
- `---`
- ` ` (ูุณุงูุฉ ูุงุฑุบุฉ)
- `""` (ูุต ูุงุฑุบ)

---

## ๐ ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ ุงูููุชุฑุญุฉ

1. โ **ุชู:** ุชุญุณูู `cleanStringValue()`
2. โ **ุชู:** ุฅุถุงูุฉ ูุญุต `referenceCode`
3. โ **ุชู:** ุฅุนุงุฏุฉ ุชูููุฏ Prisma Client
4. ๐ **ููุชุฑุญ:** ุฅุถุงูุฉ validation ููุจุฑูุฏ ุงูุฅููุชุฑููู (ุชูุณูู ุตุญูุญ)
5. ๐ **ููุชุฑุญ:** ุฅุถุงูุฉ validation ูุฑูู ุงููุงุชู (ุชูุณูู ุฏููู)
6. ๐ **ููุชุฑุญ:** ุฅุถุงูุฉ progress bar ููุตู ูุนุฑุถ ูู ุตู
7. ๐ **ููุชุฑุญ:** ุฅุถุงูุฉ ุฎูุงุฑ "ุชุฌุงูู ุงูุชูุฑุงุฑุงุช" vs "ุชุญุฏูุซ ุงูุชูุฑุงุฑุงุช"

---

## ๐ ูููุงุช ุชู ุชุนุฏูููุง

1. โ **`src/app/api/cvs/import-smart/route.ts`**
   - ุชุญุณูู `cleanStringValue()`
   - ุชุญุณูู `checkForDuplicates()`

2. โ **`prisma/schema.prisma`**
   - ุงูุญูู `cvImageUrl` ููุฌูุฏ

3. โ **`node_modules/@prisma/client`**
   - ุชู ุฅุนุงุฏุฉ ุงูุชูููุฏ

---

## โ ุญุงูุฉ ุงููุธุงู: ุฌุงูุฒ ููุนูู! ๐

ุงูุณูุฑูุฑ ุงูุขู ูุนูู ุนูู: **http://localhost:3000**

ููููู ุงูุขู:
1. โ ุฑูุน ููู `qsr-template.xlsx`
2. โ ุฌููุน ุงูุจูุงูุงุช ุณูุชู ุงุณุชูุจุงููุง ุจุดูู ุตุญูุญ
3. โ ุงูููู ุงููุงุฑุบุฉ ุณูุชู ุชุญููููุง ุฅูู `null`
4. โ ุงูุชูุฑุงุฑุงุช ุณูุชู ุงูุชุดุงููุง ููุนุงูุฌุชูุง
5. โ ุตูุฑุฉ ุงูุณูุฑุฉ ุงููุงููุฉ ุณูุชู ุญูุธ ุฑุงุจุทูุง ูุนุฑุถูุง

---

**ุชู ุงูุชูุซูู ุจูุงุณุทุฉ:** AI Assistant  
**ุขุฎุฑ ุชุญุฏูุซ:** 2 ุฃูุชูุจุฑ 2025

