# ميزة الفلاتر في صفحة تقارير الزيارات المباشرة

## الميزة الجديدة ✨
تم إضافة نظام فلترة متقدم لصفحة تقارير الزيارات المباشرة يسمح بتصفية الزيارات حسب:
1. **الدولة** 🌍
2. **الصفحة** 📄
3. **التاريخ (من - إلى)** 📅

## المزايا الرئيسية

### 1. فلتر الدولة 🗺️
- قائمة منسدلة تحتوي على جميع الدول التي تم تسجيل زيارات منها
- يعرض عدد الزيارات من كل دولة بجانب الاسم
- الخيار الافتراضي: "جميع الدول"

```
مثال:
- جميع الدول (250)
- Saudi Arabia (150)
- Egypt (80)
- United Arab Emirates (20)
```

### 2. فلتر الصفحة 📱
- قائمة منسدلة تحتوي على جميع صفحات المبيعات التي تم زيارتها
- يعرض عدد الزيارات لكل صفحة
- الخيار الافتراضي: "جميع الصفحات"

```
مثال:
- جميع الصفحات (250)
- sales1 (45)
- sales2 (38)
- sales3 (32)
```

### 3. فلتر التاريخ 📆
- حقلان لتحديد نطاق التاريخ:
  - **من تاريخ**: تاريخ البداية
  - **إلى تاريخ**: تاريخ النهاية
- يعمل على timestamp الزيارة
- يمكن تحديد تاريخ واحد فقط أو كلاهما

```
مثال:
- من: 2025-01-01
- إلى: 2025-01-24
→ يعرض الزيارات من 1 يناير حتى 24 يناير
```

## كيفية الاستخدام

### الطريقة البسيطة:
1. افتح صفحة تقارير الزيارات: `/dashboard/visits-report`
2. ستجد منطقة الفلاتر أعلى جدول الزيارات
3. اختر الفلترات المطلوبة
4. سيتم تحديث الجدول تلقائياً

### أمثلة عملية:

#### مثال 1: عرض زيارات السعودية فقط
```
الدولة: Saudi Arabia
الصفحة: جميع الصفحات
من تاريخ: (فارغ)
إلى تاريخ: (فارغ)
```

#### مثال 2: عرض زيارات sales1 خلال اليوم
```
الدولة: جميع الدول
الصفحة: sales1
من تاريخ: 2025-01-24
إلى تاريخ: 2025-01-24
```

#### مثال 3: عرض زيارات مصر على sales2 خلال الأسبوع
```
الدولة: Egypt
الصفحة: sales2
من تاريخ: 2025-01-17
إلى تاريخ: 2025-01-24
```

## واجهة المستخدم

### تصميم الفلاتر
```
┌─────────────────────────────────────────────────────────────┐
│  📍 الدولة    | 🖱️ الصفحة   | 📅 من تاريخ | 📅 إلى تاريخ │
│  [dropdown]   | [dropdown]  | [date]      | [date]        │
└─────────────────────────────────────────────────────────────┘
```

### الألوان والأيقونات:
- **الدولة**: 🟢 أخضر (MapPin)
- **الصفحة**: 🔵 أزرق (MousePointerClick)
- **من تاريخ**: 🟣 بنفسجي (Calendar)
- **إلى تاريخ**: 🟠 برتقالي (Calendar)

## زر إعادة التعيين ♻️

يوجد زر **"إعادة تعيين الفلاتر"** في الأعلى:
- يعيد جميع الفلاتر للقيم الافتراضية
- يعرض جميع الزيارات مرة أخرى
- أيقونة: ❌ (X)

## عداد النتائج 🔢

يعرض عدد الزيارات بعد التصفية:
```
آخر الزيارات (Live) (45 زيارة)
```

## رسالة "لا توجد نتائج" 🚫

عند عدم وجود زيارات تطابق الفلاتر:
```
┌─────────────────────────────────┐
│          🔍                     │
│  لا توجد زيارات تطابق          │
│  الفلاتر المحددة               │
└─────────────────────────────────┘
```

## التحديث التلقائي ⚡

الفلاتر **لا تؤثر** على التحديث التلقائي:
- الزيارات الجديدة تُضاف تلقائياً كل 5 ثوانٍ
- الفلاتر تُطبق على البيانات الجديدة أيضاً
- يمكن إيقاف/تشغيل التحديث التلقائي من الزر العلوي

## الأداء 🚀

### تحسينات الأداء:
1. **useMemo**: لحفظ نتائج الفلترة وعدم إعادة الحساب إلا عند التغيير
2. **Unique Lists**: قوائم الدول والصفحات تُحسب مرة واحدة فقط
3. **Client-side Filtering**: الفلترة تتم على البيانات الموجودة بدون طلبات API إضافية

### الذاكرة:
- الفلترة تعمل على آخر 50 زيارة (من API)
- لا تؤثر على استهلاك الذاكرة

## التوافق 📱

### المتصفحات:
✅ Chrome
✅ Firefox
✅ Safari
✅ Edge

### الأجهزة:
✅ Desktop
✅ Tablet
✅ Mobile (responsive design)

## الكود التقني

### State Management:
```typescript
const [countryFilter, setCountryFilter] = useState<string>('ALL')
const [pageFilter, setPageFilter] = useState<string>('ALL')
const [dateFrom, setDateFrom] = useState<string>('')
const [dateTo, setDateTo] = useState<string>('')
```

### منطق الفلترة:
```typescript
const filteredVisits = useMemo(() => {
  return stats.recentVisits.filter(visit => {
    // فلتر الدولة
    if (countryFilter !== 'ALL' && visit.country !== countryFilter) 
      return false
    
    // فلتر الصفحة
    if (pageFilter !== 'ALL' && visit.targetPage !== pageFilter) 
      return false
    
    // فلتر التاريخ
    const visitDate = new Date(visit.timestamp)
    if (dateFrom && visitDate < new Date(dateFrom)) return false
    if (dateTo && visitDate > new Date(dateTo)) return false
    
    return true
  })
}, [stats, countryFilter, pageFilter, dateFrom, dateTo])
```

## التطوير المستقبلي 🔮

### ميزات مقترحة:
1. **فلتر المصدر** (Google, Facebook, Direct)
2. **فلتر الحملة** (utm_campaign)
3. **فلتر المدينة**
4. **تصدير النتائج المفلترة** إلى CSV
5. **حفظ الفلاتر المفضلة**
6. **مشاركة رابط بفلترات محددة**

### تحسينات الأداء:
1. **Virtual Scrolling** للجداول الكبيرة
2. **Server-side Filtering** للبيانات الكبيرة جداً
3. **Caching** للفلاتر الشائعة

## الملفات المحدثة 📁

- `src/app/dashboard/visits-report/page.tsx` ✅

## التوثيق 📖

- `VISITS_FILTERS_FEATURE.md` - هذا الملف
- `VISITS_GEO_FIX.md` - إصلاح الموقع الجغرافي
- `DISTRIBUTION_CONVERSIONS.md` - عدد التحويلات

## الاختبار ✓

### سيناريوهات الاختبار:
1. ✅ فلترة بالدولة فقط
2. ✅ فلترة بالصفحة فقط
3. ✅ فلترة بالتاريخ فقط (من)
4. ✅ فلترة بالتاريخ فقط (إلى)
5. ✅ فلترة بجميع الفلاتر معاً
6. ✅ إعادة تعيين الفلاتر
7. ✅ عدم وجود نتائج
8. ✅ التحديث التلقائي مع الفلاتر

## الخلاصة 🎯

تم إضافة نظام فلترة قوي ومرن يسمح بتحليل الزيارات بشكل دقيق وفعال. النظام يعمل بسلاسة مع التحديث التلقائي ويوفر تجربة مستخدم ممتازة! 🎉
