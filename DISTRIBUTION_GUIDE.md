# ๐ ุฏููู ูุธุงู ุงูุชูุฒูุน ุงููุฑุฌุญ (Weighted Distribution System)

## ๐ฏ ููู ุชุชุฃูุฏ ูู ุงููุณุจ ูุงูููุงุนุฏุ

### ุงูุฎุทูุฉ 1: ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช โ๏ธ

```bash
# 1. ุฅูุดุงุก migration ููุญููู ุงูุฌุฏูุฏุฉ
npx prisma migrate dev --name add_distribution_weights

# 2. ุชุญุฏูุซ Prisma Client
npx prisma generate
```

**ูุง ูุญุฏุซ**: ูุถูู ุญููู `googleWeight` ู `otherWeight` ูุฌุฏูู `DistributionRule`

---

### ุงูุฎุทูุฉ 2: ุชุดุบูู ุงูุฎุงุฏู ๐

```bash
npm run dev
```

---

### ุงูุฎุทูุฉ 3: ุชุนุฏูู ุงููุณุจ ูู Dashboard ๐๏ธ

1. **ุงูุชุญ**: `http://localhost:3000/dashboard/distribution`
2. **ุงุถุบุท**: ุฒุฑ "ุนุฑุถ ุงูุฅุนุฏุงุฏุงุช"
3. **ุนุฏูู**: ุงููุณุจ ูู ุงูุฌุฏูู ุงูุชูุงุนูู
4. **ุงุถุบุท**: "ุญูุธ ุงูุชุบููุฑุงุช" โ

**ุงูุฌุฏูู ูุนุฑุถ**:
- **Google %**: ูุณุจุฉ ุฒูุงุฑุงุช Google ููู ุตูุญุฉ
- **Other %**: ูุณุจุฉ ุจุงูู ุงูุฒูุงุฑุงุช ููู ุตูุญุฉ
- **ุงูุญุงูุฉ**: ูุดุท / ูุนุทู
- **ุงูุฅุฌูุงูู**: ูุธูุฑ ูู ุงูุณุทุฑ ุงูุฃุฎูุฑ (ูุฌุจ ุฃู ูุณุงูู 100%)

---

### ุงูุฎุทูุฉ 4: ุงูุชุญูู ูู ุงูุญูุธ โ

#### **A. ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**:
```bash
npx prisma studio
```
ุงูุชุญ ุฌุฏูู `distribution_rules` ูุชุญูู ูู ุงูููู ุงููุญููุธุฉ.

#### **B. ูู API ูุจุงุดุฑุฉ**:
```bash
curl http://localhost:3000/api/distribution/rules
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ**:
```json
{
  "success": true,
  "rules": [
    {
      "salesPageId": "sales1",
      "googleWeight": 15,
      "otherWeight": 6.67,
      "isActive": true
    },
    // ... ุจุงูู ุงูุตูุญุงุช
  ]
}
```

---

### ุงูุฎุทูุฉ 5: ุงุฎุชุจุงุฑ ุงูุชูุฒูุน ุงููุนูู ๐งช

#### **ุงุฎุชุจุงุฑ 1: ุฒูุงุฑุฉ ูู Google**
```bash
# ูู ุงููุชุตูุญุ ุงูุชุญ:
http://localhost:3000/sales?utm_source=google&gclid=test123
```

**ูุงุฐุง ูุญุฏุซ**:
1. ููุชุดู ุงููุธุงู ุฃู ุงููุตุฏุฑ Google
2. ูุณุชุฎุฏู `googleWeight` ููุชูุฒูุน
3. ููุฌูู ูุฅุญุฏู ุตูุญุงุช ุงููุจูุนุงุช ุญุณุจ ุงููุณุจ
4. ูุญูุธ ูููู `td_bucket` - ุฅุฐุง ุนุฏุช ุณุชุฐูุจ ูููุณ ุงูุตูุญุฉ!

#### **ุงุฎุชุจุงุฑ 2: ุฒูุงุฑุฉ ูุจุงุดุฑุฉ**
```bash
http://localhost:3000/sales
```

**ูุงุฐุง ูุญุฏุซ**:
1. ููุชุดู ุงููุธุงู ุฃู ุงููุตุฏุฑ ููุณ Google
2. ูุณุชุฎุฏู `otherWeight` ููุชูุฒูุน
3. ููุฌูู ูุฅุญุฏู ุตูุญุงุช ุงููุจูุนุงุช ุญุณุจ ุงููุณุจ ุงูุฃุฎุฑู

---

### ุงูุฎุทูุฉ 6: ูุฑุงูุจุฉ ุงูุชูุฒูุน ๐

#### **ูู Dashboard**:
1. ุงูุชุญ `/dashboard/distribution`
2. ุงูุธุฑ ุฅูู **ุฅุญุตุงุฆูุงุช ุงูุฒูุงุฑุงุช ุงูููุตูุฉ**
3. ุณุชุฌุฏ:
   - ุนุฏุฏ ุงูุฒูุงุฑุงุช ููู ุตูุญุฉ
   - ุชูุฒูุน ุงููุตุงุฏุฑ (Google, Facebook, Direct, ุฅูุฎ)
   - ุฅุญุตุงุฆูุงุช ููููุฉ ูุฃุณุจูุนูุฉ ูุดูุฑูุฉ

#### **ูู ุงูู Console**:
ุงูุชุญ Developer Tools ูู ุงููุชุตูุญ โ Console
ุนูุฏ ุฒูุงุฑุฉ `/sales` ุณุชุฑู:
```
Using distribution rules from API
Redirecting to: /sales4
```

---

## ๐ ููู ุชุชุฃูุฏ ุฃู ุงูุชุนุฏููุงุช ุชูููุฐุ

### โ **ุนูุงูุงุช ุงููุฌุงุญ**:

1. **ูู Dashboard**: 
   - ุฒุฑ "ุญูุธ ุงูุชุบููุฑุงุช" ูุนุฑุถ ุฑุณุงูุฉ ูุฌุงุญ โ
   - ุงูุฅุฌูุงููุงุช ุชุณุงูู 100%

2. **ูู `/sales`**:
   - ูุชู ุงูุชูุฌูู ููุตูุญุงุช ุงููุดุทุฉ ููุท
   - ุงูุชูุฒูุน ูุชุจุน ุงููุณุจ ุงููุญุฏุฏุฉ (ุงุฎุชุจุฑ 10-20 ูุฑุฉ ูุชุฑู ุงูุชูุฒูุน)

3. **ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**:
   - ุงูููู ูู `googleWeight` ู `otherWeight` ูุญุฏุซุฉ
   - ุงูุตูุญุงุช ุงููุนุทูุฉ `isActive = false`

---

## ๐งฎ ููููุฉ ุญุณุงุจ ุงููุณุจ

### **ูุซุงู ุนููู**:

ุฅุฐุง ุฃุฑุฏุช ุฃู ูุฐูุจ **60% ูู ุฒูุงุฑุงุช Google** ูุตูุญุงุช sales1-3:
```
sales1: 20%
sales2: 20%
sales3: 20%
sales4-8: 40% ููุฒุนุฉ (8% ููู)
```

**ุงูุฅุนุฏุงุฏุงุช**:
```
sales1: Google = 20
sales2: Google = 20
sales3: Google = 20
sales4-8: Google = 8 (ููู)
```

**ุงูุชุญูู**: ูุฌููุน = 20+20+20+8+8+8+8+8 = 100 โ

---

## ๐ ุญู ุงููุดุงูู ุงูุดุงุฆุนุฉ

### **ูุดููุฉ**: ุงูุชุนุฏููุงุช ูุง ุชุธูุฑ
**ุงูุญู**: 
1. ุชุฃูุฏ ูู ุชุดุบูู migration
2. ุงูุณุญ cache ุงููุชุตูุญ
3. ุงุญุฐู ูููู `td_bucket`

### **ูุดููุฉ**: ุงูุฅุฌูุงูู ูุง ูุณุงูู 100%
**ุงูุญู**: 
- ุงุณุชุฎุฏู ุฒุฑ "ุฅุนุงุฏุฉ ุชุนููู" ููููู ุงูุงูุชุฑุงุถูุฉ
- ุฃู ุนุฏูู ุงููุณุจ ูุฏููุงู ุญุชู ูุตุจุญ ุงููุฌููุน 100

### **ูุดููุฉ**: ุฌููุน ุงูุฒูุงุฑุงุช ุชุฐูุจ ูุตูุญุฉ ูุงุญุฏุฉ
**ุงูุญู**: 
- ุงุญุฐู ูููู `td_bucket` (ููุงุฎุชุจุงุฑ)
- ุชุฃูุฏ ูู ุชูุนูู ุนุฏุฉ ุตูุญุงุช `isActive = true`

---

## ๐ ูุฑุงูุจุฉ ุงูุฃุฏุงุก

### **Metrics ุงููููุฉ**:

1. **ูุนุฏู ุงูุชุญููู**: ุฃู ุตูุญุฉ ุชุญูู ุฃูุถู ูุชุงุฆุฌุ
2. **ุชูุฒูุน ุงูุฒูุงุฑุงุช**: ูู ุงูุฃุฑูุงู ุงููุนููุฉ ุชุทุงุจู ุงููุณุจ ุงููุญุฏุฏุฉุ
3. **ูุนุฏู ุงูุงุฑุชุฏุงุฏ**: ุฃู ุตูุญุฉ ุชุญุชูุธ ุจุงูุฒูุงุฑ ุฃุทููุ

### **ุงูุฃุฏูุงุช**:
- `/dashboard/distribution` - ุฅุญุตุงุฆูุงุช ุดุงููุฉ
- Google Analytics - ุชุชุจุน ูุชูุฏู
- `/api/visits/track` - logs ุงูุฒูุงุฑุงุช

---

## ๐ ูุตุงุฆุญ ูุชูุฏูุฉ

### **1. A/B Testing**:
```
ุงูุฃุณุจูุน 1: sales1 = 50%, sales2 = 50%
ุงูุฃุณุจูุน 2: ุฒุฏ ูุณุจุฉ ุงูุตูุญุฉ ุงูุฃูุถู ุฃุฏุงุกู
```

### **2. ุงูุชูุฒูุน ุงูููุณูู**:
```javascript
// ูุซุงู: ุฑูุถุงู
sales1 (ุนุฑูุถ ุฑูุถุงู): 40%
sales2-8: 60% ููุฒุนุฉ
```

### **3. ุงุณุชูุฏุงู ุฌุบุฑุงูู**:
ุงุณุชุฎุฏู ุญูู `nationality` ูู `DistributionRule` ูุงุณุชูุฏุงู ูุญุฏุฏ

---

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ูุดุงูู:
1. ุชุญูู ูู console logs
2. ุงูุญุต Network tab ููุทูุจุงุช ุงููุงุดูุฉ
3. ุชุฃูุฏ ูู ุตูุงุญูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช

---

## โจ ุงูุฎูุงุตุฉ

**ูุธุงู ุงูุชูุฒูุน ุงููุฑุฌุญ ูุนูู ูุงูุชุงูู**:
1. ุงููุณุชุฎุฏู ูุฒูุฑ `/sales`
2. ุงููุธุงู ูุฌูุจ ุงูููุงุนุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. ูุญุฏุฏ ุงููุตุฏุฑ (Google ุฃู ูุง)
4. ูุฎุชุงุฑ ุตูุญุฉ ุนุดูุงุฆูุงู ุจูุงุกู ุนูู ุงูุฃูุฒุงู
5. ูุญูุธ ูููู ููุซุจุงุช
6. ููุฌู ุงููุณุชุฎุฏู ููุตูุญุฉ ุงููุฎุชุงุฑุฉ

**ููุชุญูู**: 
- ุนุฏูู ุงููุณุจ ูู Dashboard
- ุงุถุบุท ุญูุธ
- ุงุฎุชุจุฑ `/sales` ุนุฏุฉ ูุฑุงุช (ุงุญุฐู ุงููููู ุจูู ุงูุงุฎุชุจุงุฑุงุช)
- ุฑุงูุจ ุงูุฅุญุตุงุฆูุงุช

โ **ุงููุธุงู ุฌุงูุฒ ููุนูู!**
