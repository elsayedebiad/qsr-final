# ๐ ุชูุฒูุน ูุชุณุงูู ุนูู 11 ุตูุญุฉ ูุจูุนุงุช

## ุงูุชูุฒูุน ุงูุงูุชุฑุงุถู ุงูุฌุฏูุฏ

### โ ุฌููุน ุงูุตูุญุงุช ูุดุทุฉ (11 ุตูุญุฉ)

| ุงูุตูุญุฉ | Google % | Other % | ุงูุญุงูุฉ |
|--------|----------|---------|--------|
| Sales 1 | 9.09% | 9.09% | โ ูุดุท |
| Sales 2 | 9.09% | 9.09% | โ ูุดุท |
| Sales 3 | 9.09% | 9.09% | โ ูุดุท |
| Sales 4 | 9.09% | 9.09% | โ ูุดุท |
| Sales 5 | 9.09% | 9.09% | โ ูุดุท |
| Sales 6 | 9.09% | 9.09% | โ ูุดุท |
| Sales 7 | 9.09% | 9.09% | โ ูุดุท |
| Sales 8 | 9.09% | 9.09% | โ ูุดุท |
| Sales 9 | 9.09% | 9.09% | โ ูุดุท |
| Sales 10 | 9.09% | 9.09% | โ ูุดุท |
| Sales 11 | 9.01% | 9.01% | โ ูุดุท |
| **ุงูุฅุฌูุงูู** | **100.00%** | **100.00%** | - |

---

## ๐ ุงูุญุณุงุจุงุช

### ุงูุชูุฒูุน ุงููุชุณุงูู:
```
100% รท 11 ุตูุญุฉ = 9.0909...%
```

### ุงูุชุทุจูู:
- **10 ุตูุญุงุช**: 9.09% ููู ุตูุญุฉ = 90.90%
- **ุตูุญุฉ ูุงุญุฏุฉ** (sales11): 9.01% = 9.10%
- **ุงูุฅุฌูุงูู**: 90.90 + 9.10 = **100.00%** โ

---

## ๐ฏ ููู ุชุนุฏู ุงูุชูุฒูุนุ

### ูู Dashboard:

1. ุงูุชุญ: `http://localhost:3000/dashboard/distribution`
2. ุงุถุบุท: **"ุนุฑุถ ุงูุฅุนุฏุงุฏุงุช"**
3. ุนุฏูู ุงููุณุจ ูู ุงูุฌุฏูู
4. ุชุฃูุฏ ุฃู ุงูุฅุฌูุงูู = **100%**
5. ุงุถุบุท: **"ุญูุธ ุงูุชุบููุฑุงุช"**

---

## ๐ก ุฃูุซูุฉ ุชูุฒูุน ูุฎุตุตุฉ

### ูุซุงู 1: ุชุฑููุฒ ุนูู Sales 1-3 (Google)
```
Sales 1-3: 20% ููู = 60%
Sales 4-11: 5% ููู = 40%
```

### ูุซุงู 2: ุชูุฒูุน ุชุฏุฑูุฌู
```
Sales 1: 15%
Sales 2: 14%
Sales 3: 13%
Sales 4: 12%
Sales 5: 11%
Sales 6: 10%
Sales 7: 9%
Sales 8: 8%
Sales 9: 6%
Sales 10: 4%
Sales 11: 1%
โโโโโโโโโ
= 100%
```

### ูุซุงู 3: ุชุนุทูู ุจุนุถ ุงูุตูุญุงุช
ุฅุฐุง ุฃุฑุฏุช ุชุนุทูู Sales 7 ู Sales 11:
```
9 ุตูุญุงุช ูุดุทุฉ ููุท
100% รท 9 = 11.11% ููู ุตูุญุฉ

ุฃู ุชูุฒูุน ูุฎุตุต ุนูู 9 ุตูุญุงุช ูุตู ูู 100%
```

---

## ๐งช ุงุฎุชุจุงุฑ ุงูุชูุฒูุน

### ุทุฑููุฉ ุณุฑูุนุฉ:
```bash
# ุงุฎุชุจุงุฑ 10 ูุฑุงุช
for i in {1..10}; do
  curl -s http://localhost:3000/sales | grep -o 'sales[0-9]*'
  sleep 1
done
```

### ุงููุชูุฌุฉ ุงููุชููุนุฉ:
- ูู ุตูุญุฉ ุชุธูุฑ ูุฑุฉ ูุงุญุฏุฉ ุชูุฑูุจุงู
- ุงูุชูุฒูุน ุนุดูุงุฆู ููู ูุชูุงุฒู

---

## ๐ ุงูุฅุญุตุงุฆูุงุช ุงููุนููุฉ

ุจุนุฏ 1000 ุฒูุงุฑุฉุ ุงูุชูุฒูุน ุงููุชููุน:

| ุงูุตูุญุฉ | ุงูุฒูุงุฑุงุช ุงููุชููุนุฉ | ุงููุทุงู ุงูููุจูู |
|--------|-------------------|-----------------|
| Sales 1-10 | ~91 ุฒูุงุฑุฉ | 85-95 |
| Sales 11 | ~90 ุฒูุงุฑุฉ | 85-95 |

**ููุงุญุธุฉ**: ุงููุฑููุงุช ุงูุตุบูุฑุฉ ุทุจูุนูุฉ ูู ุงูุชูุฒูุน ุงูุนุดูุงุฆู.

---

## ๐ง ุงูุชุฎุตูุต ุงููุชูุฏู

### ุงุณุชุฎุฏุงู API ูุจุงุดุฑุฉ:

```bash
# ุฌูุจ ุงูููุงุนุฏ ุงูุญุงููุฉ
curl http://localhost:3000/api/distribution/rules

# ุญูุธ ููุงุนุฏ ุฌุฏูุฏุฉ
curl -X POST http://localhost:3000/api/distribution/rules \
  -H "Content-Type: application/json" \
  -d '{
    "rules": [
      {"path": "/sales1", "googleWeight": 10, "otherWeight": 10, "isActive": true},
      {"path": "/sales2", "googleWeight": 10, "otherWeight": 10, "isActive": true}
      // ... ุจุงูู ุงูุตูุญุงุช
    ]
  }'
```

---

## โ ุงูุชุญูู ูู ุงูุชูุฒูุน

### 1. ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
```sql
SELECT 
  salesPageId,
  googleWeight,
  otherWeight,
  isActive
FROM distribution_rules
ORDER BY salesPageId;
```

### 2. ูู Dashboard:
- ุงูุธุฑ ุงูุณุทุฑ ุงูุฃุฎูุฑ ูู ุงูุฌุฏูู
- ูุฌุจ ุฃู ูุนุฑุถ: **100.00%** ู **100.00%**

### 3. ูู ุงูุณูุฑูุจุช:
```bash
node test-distribution.js
```

---

## ๐จ ุชุฎุตูุต ุญุณุจ ุงูุฃุฏุงุก

### ุฎุทูุงุช ุงูุชุญุณูู:

1. **ุฑุงูุจ ุงูุฃุฏุงุก** ููุฏุฉ ุฃุณุจูุน
2. **ุญุฏุฏ ุงูุตูุญุงุช ุงูุฃูุถู** (ุฃุนูู conversion)
3. **ุฒุฏ ุงููุณุจุฉ** ููุตูุญุงุช ุงููุงุฌุญุฉ
4. **ููู ุงููุณุจุฉ** ููุตูุญุงุช ุงูุถุนููุฉ
5. **ุญุงูุธ ุนูู ุงูุฅุฌูุงูู = 100%**

### ูุซุงู:
```
ุจุนุฏ ุงูุงุฎุชุจุงุฑุ ูุฌุฏุช ุฃู Sales 1 ู Sales 5 ุฃูุถู ุฃุฏุงุก:

Sales 1: 20%  โ ุฒูุงุฏุฉ
Sales 5: 20%  โ ุฒูุงุฏุฉ
Sales 2-4, 6-11: 7.5% ููู = 60%
โโโโโโโโโโโโโ
= 100% โ
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุฅุฌูุงูู ุฏุงุฆูุงู = 100%**
   - Google Traffic: 100%
   - Other Traffic: 100%

2. **ุงูุชูุฒูุน ูุณุชูู**
   - ูุณุจ Google ูุณุชููุฉ ุนู ูุณุจ Other
   - ูููู ุฃู ุชููู ูุฎุชููุฉ ุชูุงูุงู

3. **ุงูุซุจุงุช (Sticky Sessions)**
   - ููุณ ุงูุฒุงุฆุฑ ูุฐูุจ ูููุณ ุงูุตูุญุฉ (7 ุฃูุงู)
   - ูุชุฌุฑุจุฉ ุงูุชูุฒูุนุ ุงุญุฐู ูููู `td_bucket`

4. **ุงูุชุญุฏูุซ ุงูููุฑู**
   - ุงูุชุนุฏููุงุช ูู Dashboard ุชูุทุจู ููุฑุงู
   - ูุง ุญุงุฌุฉ ูุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู

---

## ๐ ุงูุจุฏุก ุงูุณุฑูุน

```bash
# 1. Migration
npx prisma migrate dev --name add_distribution_weights
npx prisma generate

# 2. ุชุดุบูู
npm run dev

# 3. ุงูุชุญ Dashboard
# http://localhost:3000/dashboard/distribution

# 4. ุงุถุบุท "ุนุฑุถ ุงูุฅุนุฏุงุฏุงุช"

# 5. ุชุญูู ูู ุงูุฅุฌูุงูู = 100%

# 6. ุงุถุบุท "ุญูุธ ุงูุชุบููุฑุงุช"

# 7. ุงุฎุชุจุฑ
# http://localhost:3000/sales
```

---

## โจ ุงูุฎูุงุตุฉ

**ุงูุขู ูุฏูู**:
- โ 11 ุตูุญุฉ ูุจูุนุงุช ูุดุทุฉ
- โ ุชูุฒูุน ูุชุณุงูู ุงูุชุฑุงุถูุงู (9.09% ููู ุตูุญุฉ)
- โ ุฅุฌูุงูู ุฏุงุฆูุงู = 100%
- โ ุชุฎุตูุต ูุงูู ูู Dashboard
- โ ุชุทุจูู ููุฑู ููุชุนุฏููุงุช

**ุฌุฑุจ ุงูุขู!** ๐
