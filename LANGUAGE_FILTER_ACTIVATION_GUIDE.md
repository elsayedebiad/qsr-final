# 🚀 دليل تفعيل فلاتر اللغات والخبرة - خطوة بخطوة

## ✅ التحديثات المنفذة:

### فلاتر اللغات:
1. ✅ تحديث database schema - إضافة حقول `arabicLevelRaw` و `englishLevelRaw`
2. ✅ تحديث دالة التحويل في Import System
3. ✅ تحديث API endpoint لإرجاع الحقول الجديدة
4. ✅ تحديث منطق الفلترة مع fallback للبيانات القديمة
5. ✅ الفلتر يعرض 4 مستويات: لا، ضعيف، جيد، ممتاز

### فلتر الخبرة:
1. ✅ قراءة سنوات الخبرة من عمود "خبرة سيستم" في الشيت
2. ✅ تحويل تلقائي إلى صيغة "X سنة"
3. ✅ فلتر ديناميكي يعرض كل السنوات الموجودة في الشيت
4. ✅ ترتيب تلقائي من الأقل إلى الأكثر خبرة

---

## 🔧 خطوات التفعيل (يجب تنفيذها بالترتيب):

### الخطوة 1: تحديث قاعدة البيانات ⚠️ مهم جداً

يجب إضافة الحقول الجديدة لقاعدة البيانات. **اختر إحدى الطريقتين:**

#### **الطريقة الأولى (مفضلة):**
افتح Terminal في مجلد المشروع واكتب:

```bash
cd /Users/tech.dep/Desktop/qsr-final
npx prisma db push
```

إذا سألك عن data loss، اكتب `yes` أو استخدم:
```bash
npx prisma db push --accept-data-loss
```

#### **الطريقة الثانية (إذا لم تنجح الأولى):**
افتح Database Management Tool (مثل pgAdmin أو DBeaver) ونفذ هذا الكود مباشرة:

```sql
ALTER TABLE "CV" ADD COLUMN IF NOT EXISTS "englishLevelRaw" TEXT;
ALTER TABLE "CV" ADD COLUMN IF NOT EXISTS "arabicLevelRaw" TEXT;
```

---

### الخطوة 2: إعادة تشغيل Next.js Server ⚠️ مهم

بعد تحديث قاعدة البيانات، أوقف السيرفر وشغّله من جديد:

```bash
# أوقف السيرفر (Ctrl + C)
# ثم شغّله من جديد:
npm run dev
```

---

### الخطوة 3: إعادة رفع الشيت ⚠️ إلزامي

**لازم ترفع الشيت مرة ثانية!** البيانات القديمة لا تحتوي على القيم المحولة.

1. افتح المتصفح واذهب إلى صفحة الرفع الذكي
2. ارفع ملف `System Test_final.xlsx` مرة أخرى
3. **افتح Console** (اضغط F12 → Console)
4. شاهد رسائل التحويل:
   ```
   📊 معالجة صف 1: أسناكيتش كاساهون توشي
     🌐 arabicLevelRaw: "لا" => "لا"
     🌐 englishLevelRaw: "لا" => "لا"
   
   📊 معالجة صف 2: جينيفر إم أماكنا
     🌐 arabicLevelRaw: "لا" => "لا"
     🌐 englishLevelRaw: "متوسط" => "جيد"
   
   📊 معالجة صف 5: بيرا مورين
     🌐 arabicLevelRaw: "ضعيف" => "ضعيف"
     🌐 englishLevelRaw: "متوسط" => "جيد"
   ```
5. انتظر حتى تنتهي عملية الرفع بنجاح

---

### الخطوة 4: اختبار الفلاتر 🎯

1. اذهب إلى صفحة **Sales 1**
2. اضغط على **"فلاتر متقدمة"**

#### اختبار فلتر اللغة الإنجليزية:
- اختر **"جيد"**
- يجب أن يعرض كل من عنده: متوسط، مقبول، أو نعم في الشيت

#### اختبار فلتر اللغة العربية:
- اختر **"لا"**
- يجب أن يعرض كل من عنده: لا أو غير متاح في الشيت
- جرّب باقي المستويات: **ضعيف** و **ممتاز**

#### اختبار فلتر الخبرة:
- اختر **"2 سنة"**
- يجب أن يعرض جميع السير الذاتية التي لديها 2 سنة خبرة
- الفلتر يعرض فقط السنوات الموجودة في البيانات (2، 4، 5، 6، 9)

---

## 📊 قواعد التحويل:

### فلتر الخبرة 💼:

النظام يقرأ من عمود **"خبرة سيستم"** في الشيت (الأرقام):

| القيمة في الشيت | ← | النتيجة |
|-----------------|---|---------|
| 2               | ← | 2 سنة   |
| 4               | ← | 4 سنة   |
| 5               | ← | 5 سنة   |
| 6               | ← | 6 سنة   |
| 9               | ← | 9 سنة   |

**في صفحة Sales 1:**
- الفلتر يعرض فقط السنوات الموجودة في البيانات
- يعرض عدد السير الذاتية لكل سنة
- ترتيب تلقائي من الأقل للأكثر

---

### من الشيت → إلى الفلتر:

| القيمة في الشيت | المستوى في الفلتر |
|-----------------|-------------------|
| لا              | ❌ لا              |
| غير متاح        | ❌ لا              |
| ضعيف            | ⚠️ ضعيف           |
| متوسط           | ✅ جيد             |
| مقبول           | ✅ جيد             |
| نعم             | ✅ جيد             |
| OK              | ✅ جيد             |
| ممتاز           | ⭐ ممتاز           |
| جيد جداً        | ⭐ ممتاز           |

---

## 🔍 التحقق من نجاح التفعيل:

### ✅ علامات النجاح:

1. **أثناء رفع الشيت:**
   - تظهر رسائل 🌐 في Console
   - لا توجد أخطاء في عملية الرفع

2. **في صفحة Sales 1:**
   - الفلتر يعرض: الكل، لا، ضعيف، جيد، ممتاز
   - عند اختيار "جيد" يظهر السير الذاتية المناسبة
   - عند تغيير الفلتر يتحدث العدد في المربعات

3. **في Console المتصفح (F12):**
   - لا توجد أخطاء باللون الأحمر
   - البيانات تُجلب بنجاح

---

## ❌ إذا لم يعمل الفلتر:

### المشكلة 1: الفلتر لا يعرض نتائج
**الحل:**
1. تأكد من تنفيذ **الخطوة 1** (تحديث قاعدة البيانات)
2. تأكد من **إعادة رفع الشيت** (الخطوة 3)
3. افتح Console وتحقق من عدم وجود أخطاء

### المشكلة 2: Database migration failed
**الحل:**
- استخدم الطريقة الثانية وشغّل SQL مباشرة على قاعدة البيانات

### المشكلة 3: البيانات القديمة لا تظهر
**الحل:**
- النظام يدعم fallback تلقائي للبيانات القديمة
- لكن لأفضل أداء، يُفضل إعادة رفع الشيت

---

## 🎯 ملخص سريع:

```bash
# 1. تحديث قاعدة البيانات
npx prisma db push

# 2. إعادة تشغيل السيرفر
npm run dev

# 3. رفع الشيت من خلال المتصفح
# 4. اختبار الفلتر في Sales 1
```

---

## 📝 ملاحظات إضافية:

1. **الفلتر يعمل مع أي قيمة:** حتى لو كتبت "Good" أو "جيد" أو "متوسط"، النظام يحولها تلقائياً
2. **البيانات القديمة آمنة:** النظام يدعم fallback للبيانات الموجودة مسبقاً
3. **لا حاجة لتعديل الشيت:** اكتب القيم كما تريد، النظام يفهمها
4. **الأداء محسّن:** الفلترة تعمل بسرعة حتى مع آلاف السير الذاتية

---

## 🆘 الدعم:

إذا واجهت أي مشكلة:
1. افتح Console (F12) وابحث عن أخطاء باللون الأحمر
2. تأكد من أن قاعدة البيانات محدثة
3. تأكد من أن الشيت تم رفعه بعد التحديثات
4. أعد تشغيل السيرفر

---

**تم التحديث: أكتوبر 2025** 🚀

**كل شيء جاهز! فقط نفذ الخطوات الأربع بالترتيب** ✅

