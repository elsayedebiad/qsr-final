# 🔄 دليل استخدام زر إعادة تعيين النظام

## 📋 نظرة عامة
تم تفعيل ميزة **إعادة تعيين النظام** بالكامل لحذف جميع البيانات التجريبية والبدء بالبيانات الحقيقية.

---

## ✅ الميزات المفعلة

### 1. زر إعادة التعيين في القائمة الجانبية
- ✅ يظهر فقط للمدراء والمطورين (ADMIN & DEVELOPER)
- ✅ تصميم جذاب بألوان برتقالي وأحمر مع أيقونات متحركة
- ✅ رسالة توضيحية أسفل الزر

### 2. نافذة تأكيد قوية
عند الضغط على الزر تظهر نافذة تحذيرية تتضمن:
- ⚠️ تحذير واضح بألوان حمراء
- 📋 قائمة كاملة بالبيانات التي سيتم حذفها
- 🔒 زر تأكيد نهائي "نعم، احذف كل شيء"
- ❌ زر إلغاء للتراجع

### 3. حماية الصلاحيات
- 🔐 فقط المستخدمون بصلاحيات **DEVELOPER** أو **ADMIN**
- 🔐 أو حساب المطور الرئيسي `developer@system.local`
- ⛔ باقي المستخدمين لا يمكنهم رؤية أو استخدام الزر

---

## 🎯 كيفية الاستخدام

### الطريقة 1: من واجهة المستخدم (موصى بها)

1. **تسجيل الدخول**
   - استخدم حساب مدير أو مطور
   - مثال: `admin@qsr.com` أو `developer@system.local`

2. **فتح القائمة الجانبية**
   - ستجد زر **"إعادة تعيين النظام"** بلون برتقالي/أحمر
   - يظهر تحت معلومات المستخدم

3. **الضغط على الزر**
   - ستظهر نافذة تأكيد
   - اقرأ قائمة البيانات التي سيتم حذفها

4. **التأكيد النهائي**
   - اضغط **"نعم، احذف كل شيء"** للمتابعة
   - أو اضغط **"إلغاء"** للتراجع

5. **انتظر الانتهاء**
   - ستظهر رسالة "جاري إعادة تعيين البيانات..."
   - بعد الانتهاء سيتم إعادة تحميل الصفحة تلقائياً
   - ستظهر رسالة نجاح "النظام جاهز للبيانات الحقيقية"

### الطريقة 2: من Terminal (للمطورين)

```bash
node scripts/reset-system.js
```

- سيطلب منك كتابة `DELETE ALL` للتأكيد
- يعمل مباشرة على قاعدة البيانات

---

## 🗑️ البيانات التي سيتم حذفها

### ✅ سيتم حذف:
- ❌ **جميع السير الذاتية** (CVs)
- ❌ **جميع نسخ السير الذاتية** (CV Versions)
- ❌ **جميع العقود** (Contracts)
- ❌ **جميع الحجوزات** (Bookings)
- ❌ **جميع الأنشطة** (Activity Logs)
- ❌ **جميع الإشعارات** (Notifications)
- ❌ **جميع الجلسات** (Sessions & User Sessions)
- ❌ **جميع تفعيلات الدخول** (Login Activations)
- ❌ **جميع البنرات الإعلانية** (Banners)
- ❌ **جميع إعدادات المبيعات** (Sales Configs)
- ❌ **جميع إعدادات النظام** (System Settings)
- ❌ **جميع المستخدمين** (عدا developer@system.local و admin@qsr.com)

### ✅ لن يتم حذف:
- ✔️ حساب المطور `developer@system.local`
- ✔️ حساب المدير العام `admin@qsr.com`
- ✔️ ملفات النظام والكود البرمجي
- ✔️ قاعدة البيانات نفسها (فقط المحتوى)
- ✔️ الصور والملفات المرفوعة على السيرفر

---

## ⚠️ تحذيرات مهمة جداً

### 🚨 قبل الحذف:

1. **لا يمكن التراجع!**
   - هذا الإجراء نهائي 100%
   - لا توجد طريقة لاسترجاع البيانات المحذوفة

2. **خذ نسخة احتياطية**
   - إذا كنت قد تحتاج أي بيانات حالية
   - احفظ قاعدة البيانات قبل الحذف
   ```bash
   pg_dump DATABASE_NAME > backup_$(date +%Y%m%d).sql
   ```

3. **أبلغ الفريق**
   - أخبر جميع المستخدمين قبل إعادة التعيين
   - سيتم تسجيل خروج الجميع تلقائياً

4. **اختبر على بيئة التطوير أولاً**
   - جرب العملية على بيئة اختبار قبل الإنتاج

---

## 📊 بعد إعادة التعيين

### ما الذي يحدث؟

1. **تنظيف كامل**
   - النظام فارغ تماماً من البيانات
   - جاهز لاستقبال البيانات الحقيقية

2. **إعادة تعيين التسلسلات**
   - جميع ID sequences تبدأ من 1
   - السير الذاتية الجديدة ستبدأ من ID: 1

3. **الحسابات المتبقية**
   - فقط حساب المطور والمدير
   - جميع الحسابات الأخرى محذوفة

4. **إعادة التحميل التلقائي**
   - الصفحة ستُحدّث تلقائياً
   - ستظهر لوحة تحكم نظيفة

---

## 🎯 متى تستخدم هذه الميزة؟

### استخدامات موصى بها:

✅ **قبل الإطلاق الرسمي**
- لحذف كل البيانات التجريبية
- للبدء بقاعدة بيانات نظيفة

✅ **بعد فترة اختبار طويلة**
- عندما تكون قاعدة البيانات ممتلئة ببيانات اختبار
- للبدء من الصفر

✅ **عند تسليم المشروع**
- تسليم نظام نظيف للعميل
- بدون أي بيانات تجريبية

### ⛔ لا تستخدمها:

❌ **إذا كان النظام في الإنتاج**
- إلا إذا كنت متأكداً 100%
- وأخذت نسخة احتياطية

❌ **دون تنسيق مع الفريق**
- قد يؤثر على عمل الآخرين

❌ **دون نسخة احتياطية**
- قد تفقد بيانات مهمة

---

## 🛠️ الملفات المتعلقة

### 1. API Endpoint
```
src/app/api/reset-data/route.ts
```
- يتحقق من الصلاحيات
- يحذف جميع البيانات
- يعيد تعيين الـ sequences

### 2. Sidebar Component
```
src/components/Sidebar.tsx
```
- يحتوي على زر إعادة التعيين
- نافذة التأكيد
- معالجة الحدث

### 3. Terminal Script
```
scripts/reset-system.js
```
- سكريبت للاستخدام من Terminal
- مفيد للمطورين

---

## 🔒 الصلاحيات المطلوبة

### يمكن استخدام الميزة فقط بواسطة:

1. **DEVELOPER Role**
   - حساب المطور الرئيسي
   - `developer@system.local`

2. **ADMIN Role**
   - المدير العام
   - `admin@qsr.com`

### لا يمكن استخدامها بواسطة:
- ❌ SUB_ADMIN
- ❌ CUSTOMER_SERVICE
- ❌ USER
- ❌ أي صلاحيات أخرى

---

## 💡 نصائح للاستخدام الآمن

### قبل الحذف:
1. ✅ راجع قائمة البيانات في نافذة التأكيد
2. ✅ تأكد أنك لا تحتاج أي بيانات حالية
3. ✅ خذ نسخة احتياطية من قاعدة البيانات
4. ✅ أبلغ الفريق بالعملية

### بعد الحذف:
1. ✅ تأكد من نجاح العملية
2. ✅ راجع الحسابات المتبقية
3. ✅ ابدأ برفع البيانات الحقيقية فوراً
4. ✅ راقب سجلات النظام

### للاختبار:
1. ✅ جرب الميزة على بيئة تطوير أولاً
2. ✅ لا تختبر على بيئة الإنتاج
3. ✅ تأكد من عمل النسخ الاحتياطي

---

## 📝 سجل التحديثات

**التحديث الأخير**: تم إزالة وضع الاختبار وتفعيل الحماية الكاملة

### التغييرات:
- ✅ إزالة رسالة "TEST MODE"
- ✅ تفعيل التحقق من الصلاحيات بالكامل
- ✅ الزر يظهر فقط للمدراء والمطورين
- ✅ رسائل خطأ واضحة للمستخدمين غير المصرح لهم
- ✅ تحسين تصميم زر إعادة التعيين

---

## 🚀 أمثلة الاستخدام

### مثال 1: إعادة تعيين قبل الإطلاق
```
1. تسجيل دخول كمدير
2. فتح القائمة الجانبية
3. الضغط على "إعادة تعيين النظام"
4. قراءة قائمة البيانات
5. تأكيد "نعم، احذف كل شيء"
6. انتظار الانتهاء
7. البدء برفع البيانات الحقيقية
```

### مثال 2: استخدام من Terminal
```bash
# 1. فتح Terminal
cd /path/to/project

# 2. تشغيل السكريبت
node scripts/reset-system.js

# 3. كتابة التأكيد
> DELETE ALL

# 4. انتظار الانتهاء
✅ SYSTEM RESET COMPLETE
```

---

## ❓ الأسئلة الشائعة

### س: هل يمكن استرجاع البيانات بعد الحذف؟
❌ **لا**، العملية نهائية ولا يمكن التراجع عنها. لذلك خذ نسخة احتياطية دائماً.

### س: ماذا يحدث للمستخدمين المسجلين حالياً؟
🔒 سيتم تسجيل خروجهم تلقائياً وحذف جميع جلساتهم.

### س: هل سيتم حذف الصور والملفات؟
❌ لا، فقط البيانات في قاعدة البيانات. الملفات على السيرفر تبقى كما هي.

### س: كم من الوقت تستغرق العملية؟
⚡ عادة أقل من 5 ثواني، حسب حجم البيانات.

### س: هل يمكن للمستخدم العادي استخدام الميزة؟
❌ لا، فقط DEVELOPER و ADMIN. باقي المستخدمين لن يروا الزر أصلاً.

### س: ماذا لو حدث خطأ أثناء الحذف؟
⚠️ سيتوقف النظام وسيعرض رسالة خطأ. قد تحتاج لإعادة المحاولة أو التواصل مع الدعم الفني.

---

## 📞 الدعم الفني

إذا واجهت أي مشاكل:
1. راجع سجلات الأخطاء في Console
2. تحقق من صلاحيات المستخدم
3. تأكد من اتصال قاعدة البيانات
4. اتصل بالدعم الفني

---

> ⚠️ **تذكير أخير**: هذه الميزة قوية جداً وخطيرة! استخدمها بحذر شديد وفقط عند الضرورة القصوى.

> 💡 **نصيحة**: دائماً اختبر على بيئة التطوير أولاً قبل استخدامها على الإنتاج.

---

✅ **النظام جاهز الآن للاستخدام!**

