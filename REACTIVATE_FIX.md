# โ ุฅุตูุงุญ: ุฅุนุงุฏุฉ ุงูุชูุนูู ุชูุนูุฏ ุงูุฑูู ูููุซู ุงููุจูุนุงุช ุงูุฃุตูู

## ุงููุดููุฉ ุงูุชู ุชู ุญููุง:

**ูุจู ุงูุฅุตูุงุญ:** โ
```
ุงูุฃุฏูู ูุถุบุท [๐ ุฅุนุงุฏุฉ ุชูุนูู]
โ
โ ุงููุคูุช ููุญุฐู (deadlineAt = null)
โ isExpired = false
โ ููู ุงูุฑูู ูุจูู ูุญููุงู (isTransferred = true)
โ ูุง ูุธูุฑ ุนูุฏ ููุซู ุงููุจูุนุงุช ุงูุฃุตูู!
```

**ุจุนุฏ ุงูุฅุตูุงุญ:** โ
```
ุงูุฃุฏูู ูุถุบุท [๐ ุฅุนุงุฏุฉ ุชูุนูู]
โ
โ ุงููุคูุช ููุญุฐู
โ isExpired = false
โ ุงูุชุญููู ูููุบู (isTransferred = false)
โ ุงูุฑูู ูุนูุฏ ููุตูุญุฉ ุงูุฃุตููุฉ (originalSalesPageId)
โ ูุธูุฑ ุนูุฏ ููุซู ุงููุจูุนุงุช ุงูุฃุตูู!
```

---

## ๐ฏ ููู ูุนูู ุงูุขู:

### **ุงูุณููุงุฑูู ุงููุงูู:**

#### 1๏ธโฃ **ุงูุจุฏุงูุฉ:**
```
ุงูุฑูู: 0501234567
ุงูุตูุญุฉ: sales1
ุงููุงูู: ููุซู ูุจูุนุงุช "ุนูู"
ุงูุญุงูุฉ: ูุดุท โ
```

#### 2๏ธโฃ **ุงูุชุญููู ูุน ูุคูุช:**
```
ุงูุฃุฏูู ูุญูู ุงูุฑูู ุฅูู "ุฃุญูุฏ" ููุฏุฉ 30 ุฏูููุฉ
โ
ุงูุฑูู: 0501234567
salesPageId: sales1 (ุชุจูู ููุง ูู ูุคูุชุงู)
originalSalesPageId: sales1 โ ููุญูุธ ุงูุฃุตู
transferredToUserId: ุฃุญูุฏ
deadlineAt: 2024-11-28 17:00:00
ุงูุญุงูุฉ: ูุญูู ูุน ูุคูุช โฑ๏ธ
```

#### 3๏ธโฃ **ุงูุชูุงุก ุงููุคูุช (ุจุฏูู ุชูุงุตู):**
```
ุจุนุฏ 30 ุฏูููุฉ...
โ
ุงูุฑูู: 0501234567 (blur)
isExpired: true
isTransferred: true
ุงูุญุงูุฉ: ๐ด ูุญูู (ูุนุทู)

"ุนูู" ูุฑู: โโโโโโโโ + "ุชู ุณุญุจ ุงูุฑูู"
"ุฃุญูุฏ" ูุฑู: โโโโโโโโ + "ุชู ุณุญุจ ุงูุฑูู"
```

#### 4๏ธโฃ **ุงูุฃุฏูู ูุถุบุท [๐ ุฅุนุงุฏุฉ ุชูุนูู]:**
```
API ูููู ุจู:
โ
โ isExpired = false
โ isTransferred = false
โ transferredToUserId = null
โ salesPageId = sales1 (ูู originalSalesPageId)
โ originalSalesPageId = null
โ deadlineAt = null
โ ูู ูุนูููุงุช ุงูุชุญููู = null

ุงููุชูุฌุฉ:
ุงูุฑูู: 0501234567
ุงูุตูุญุฉ: sales1
ุงููุงูู: ููุซู ูุจูุนุงุช "ุนูู" โ ุนุงุฏ ููุฃุตู!
ุงูุญุงูุฉ: ูุดุท โ
```

#### 5๏ธโฃ **ูุซู ุงูุจุฏุงูุฉ ุชูุงูุงู:**
```
"ุนูู" ูุฑู: 0501234567 (ูุงุถุญ) โ
"ุฃุญูุฏ": ูุง ูุฑู ุงูุฑูู (ุงุฎุชูู ูู ูุงุฆูุชู)
ุงูุฃุฏูู: ูุฑู ุงูุฑูู ูู sales1 (ูุดุท)
```

---

## ๐ง ุงูุชุนุฏููุงุช ุงูุชูููุฉ:

### **ูู `check-expired/route.ts`:**

#### ุงููุฏูู: โ
```typescript
data: {
  isExpired: false,
  expiredAt: null,
  deadlineAt: null,
  // ... ููุท ุญุฐู ุงููุคูุช
}
```

#### ุงูุฌุฏูุฏ: โ
```typescript
// 1. ุฌูุจ originalSalesPageId ุฃููุงู
const phoneNumber = await db.phoneNumber.findUnique({
  where: { id: parseInt(phoneNumberId) },
  select: {
    originalSalesPageId: true,
    salesPageId: true
  }
})

// 2. ุฅุนุงุฏุฉ ุงูุชูุนูู + ุฅูุบุงุก ุงูุชุญููู
data: {
  // ุฅูุบุงุก ุงูุงูุชูุงุก
  isExpired: false,
  expiredAt: null,
  
  // ุฅูุบุงุก ุงูุชุญููู
  isTransferred: false,
  transferredToUserId: null,
  transferredBy: null,
  transferredAt: null,
  transferReason: null,
  
  // ุฅุนุงุฏุฉ ููุตูุญุฉ ุงูุฃุตููุฉ
  salesPageId: phoneNumber.originalSalesPageId || phoneNumber.salesPageId,
  originalSalesPageId: null,
  
  // ุญุฐู ุงููุคูุช
  deadlineAt: null,
  deadlineHours: null,
  deadlineMinutes: null,
  deadlineSeconds: null
}
```

---

## ๐ ุงูููุงุฑูุฉ:

| ุงูุญูู | ูุจู ุงูุชุญููู | ุจุนุฏ ุงูุชุญููู | ุจุนุฏ ุงูุงูุชูุงุก | ุจุนุฏ ุฅุนุงุฏุฉ ุงูุชูุนูู |
|-------|------------|-------------|--------------|-------------------|
| salesPageId | sales1 | sales1 | sales1 | **sales1** โ |
| originalSalesPageId | null | **sales1** | sales1 | **null** โ |
| isTransferred | false | true | true | **false** โ |
| transferredToUserId | null | ุฃุญูุฏ | ุฃุญูุฏ | **null** โ |
| isExpired | false | false | true | **false** โ |
| deadlineAt | null | 17:00 | 17:00 | **null** โ |

---

## โจ ุงูููุงุฆุฏ:

### โ **ุงูุนูุฏุฉ ุงููุงููุฉ**:
- ุงูุฑูู ูุนูุฏ ููุดุฎุต ุงูุฃุตูู ูุฃู ุดูุฆุงู ูู ููู
- ุฌููุน ูุนูููุงุช ุงูุชุญููู ุชูุญุฐู

### โ **ุงูุธููุฑ ุงูุตุญูุญ**:
- ููุซู ุงููุจูุนุงุช ุงูุฃุตูู ูุฑู ุงูุฑูู ูุงุถุญุงู ูู ูุงุฆูุชู
- ุงููุญูู ุฅููู ูุง ูุฑุงู (ุงุฎุชูู ูู ูุงุฆูุชู)

### โ **ุณุฌู ูุธูู**:
- ูุง ุชูุฌุฏ ุขุซุงุฑ ููุชุญููู ุงููุงุดู
- ุงูุฑูู ูุดุท ูุฌุงูุฒ ููุนูู

### โ **ุงูุตูุญุฉ ุงูุตุญูุญุฉ**:
- ุงูุฑูู ูุนูุฏ ูุตูุญุชู ุงูุฃุตููุฉ (originalSalesPageId)
- ุฅุญุตุงุฆูุงุช ุงูุตูุญุงุช ุชููู ุฏูููุฉ

---

## ๐ฏ ุญุงูุงุช ุงูุงุณุชุฎุฏุงู:

### **ุญุงูุฉ 1: ุชุญููู ูุงุดู**
```
ุนูู ูู ูุชูุงุตู โ ุชู ุงูุชุญููู โ ุฃุญูุฏ ูู ูุชูุงุตู โ ุงูุชูู ุงูููุช
โ
ุงูุฃุฏูู ูุนูุฏ ุงูุชูุนูู
โ
ุงูุฑูู ูุนูุฏ ูุนูู (ูุฑุตุฉ ุฌุฏูุฏุฉ)
```

### **ุญุงูุฉ 2: ุฎุทุฃ ูู ุงูุชุญููู**
```
ุงูุฃุฏูู ุญููู ุจุงูุฎุทุฃ ูุดุฎุต ุฎุทุฃ
โ
ุงูุฃุฏูู ูุนูุฏ ุงูุชูุนูู ููุฑุงู
โ
ุงูุฑูู ูุนูุฏ ููุฃุตู (ูุฃู ุงูุชุญููู ูู ูุญุฏุซ)
```

### **ุญุงูุฉ 3: ุฅุนุงุฏุฉ ุชูุฒูุน**
```
ุฑูู ูุญูู ูุฏูู ููุชูู
โ
ุงูุฃุฏูู ูุนูุฏ ุงูุชูุนูู
โ
ุงูุฑูู ูุนูุฏ ููุฃุตู (ุฌุงูุฒ ูุชูุฒูุน ุฌุฏูุฏ)
```

---

**ุฌุงูุฒ! ุฅุนุงุฏุฉ ุงูุชูุนูู ุงูุขู ุชุนูู ุจุดูู ูุงูู! ๐**
